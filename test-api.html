<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow: auto;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <h1>Google Sheets API Test</h1>
    
    <div class="section">
        <h2>Register Student</h2>
        <form id="registerForm">
            <label for="regTelegramId">Telegram ID:</label>
            <input type="text" id="regTelegramId" name="telegramId" required>
            
            <label for="regClass">Class:</label>
            <input type="text" id="regClass" name="class" required>
            
            <label for="regLastName">Last Name:</label>
            <input type="text" id="regLastName" name="lastName" required>
            
            <label for="regFirstName">First Name:</label>
            <input type="text" id="regFirstName" name="firstName" required>
            
            <button type="submit">Register Student</button>
        </form>
        <pre id="registerResult"></pre>
    </div>
    
    <div class="section">
        <h2>Get User</h2>
        <form id="getUserForm">
            <label for="getUserTelegramId">Telegram ID:</label>
            <input type="text" id="getUserTelegramId" name="telegramId" required>
            
            <button type="submit">Get User</button>
        </form>
        <pre id="getUserResult"></pre>
    </div>
    
    <div class="section">
        <h2>Add Homework</h2>
        <form id="addHomeworkForm">
            <label for="hwClass">Class:</label>
            <input type="text" id="hwClass" name="class" required>
            
            <label for="hwSubject">Subject:</label>
            <input type="text" id="hwSubject" name="subject" required>
            
            <label for="hwDescription">Description:</label>
            <input type="text" id="hwDescription" name="description" required>
            
            <label for="hwDeadline">Deadline (YYYY-MM-DD):</label>
            <input type="date" id="hwDeadline" name="deadline" required>
            
            <button type="submit">Add Homework</button>
        </form>
        <pre id="addHomeworkResult"></pre>
    </div>
    
    <div class="section">
        <h2>Get Homework</h2>
        <form id="getHomeworkForm">
            <label for="getHwClass">Class:</label>
            <input type="text" id="getHwClass" name="class" required>
            
            <button type="submit">Get Homework</button>
        </form>
        <pre id="getHomeworkResult"></pre>
    </div>
    
    <div class="section">
        <h2>Submit Homework</h2>
        <form id="submitHomeworkForm">
            <label for="submitTelegramId">Telegram ID:</label>
            <input type="text" id="submitTelegramId" name="telegramId" required>
            
            <label for="submitHomeworkId">Homework ID:</label>
            <input type="text" id="submitHomeworkId" name="homeworkId" required>
            
            <label for="submitFile">File:</label>
            <input type="file" id="submitFile" name="file" required>
            
            <button type="submit">Submit Homework</button>
        </form>
        <pre id="submitHomeworkResult"></pre>
    </div>

    <script>
        // Base URL for API endpoints
        const baseUrl = '/.netlify/functions';
        
        // Register Student
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const data = {
                telegramId: form.telegramId.value,
                class: form.class.value,
                lastName: form.lastName.value,
                firstName: form.firstName.value
            };
            
            try {
                const response = await fetch(`${baseUrl}/register-student`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                document.getElementById('registerResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('registerResult').textContent = `Error: ${error.message}`;
            }
        });
        
        // Get User
        document.getElementById('getUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            
            try {
                const response = await fetch(`${baseUrl}/get-user?telegramId=${form.telegramId.value}`);
                const result = await response.json();
                document.getElementById('getUserResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('getUserResult').textContent = `Error: ${error.message}`;
            }
        });
        
        // Add Homework
        document.getElementById('addHomeworkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const data = {
                class: form.class.value,
                subject: form.subject.value,
                description: form.description.value,
                deadline: form.deadline.value
            };
            
            try {
                const response = await fetch(`${baseUrl}/add-homework`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                document.getElementById('addHomeworkResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('addHomeworkResult').textContent = `Error: ${error.message}`;
            }
        });
        
        // Get Homework
        document.getElementById('getHomeworkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            
            try {
                const response = await fetch(`${baseUrl}/get-homework?class=${form.class.value}`);
                const result = await response.json();
                document.getElementById('getHomeworkResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('getHomeworkResult').textContent = `Error: ${error.message}`;
            }
        });
        
        // Submit Homework
        document.getElementById('submitHomeworkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const file = form.file.files[0];
            
            if (!file) {
                document.getElementById('submitHomeworkResult').textContent = 'Please select a file';
                return;
            }
            
            try {
                // Read file as base64
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const base64Content = event.target.result.split(',')[1];
                    
                    const data = {
                        telegramId: form.telegramId.value,
                        homeworkId: form.homeworkId.value,
                        fileData: {
                            fileName: file.name,
                            fileContent: base64Content,
                            fileType: file.type
                        }
                    };
                    
                    try {
                        const response = await fetch(`${baseUrl}/submit-homework-sheets`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });
                        
                        const result = await response.json();
                        document.getElementById('submitHomeworkResult').textContent = JSON.stringify(result, null, 2);
                    } catch (error) {
                        document.getElementById('submitHomeworkResult').textContent = `Error: ${error.message}`;
                    }
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                document.getElementById('submitHomeworkResult').textContent = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>
